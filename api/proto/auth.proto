syntax = "proto3";

package auth;
option go_package = "./api/authpb";

// User Model
message AuthUser {
  string id = 1;
  string email = 2;
  string role = 3; // user / admin
  bool email_verified = 4;
  string created_at = 5;
}

// Send Magic Link (Email Verification / Login)
message SendMagicLinkRequest {
  string email = 1;
}

message SendMagicLinkResponse {
  string message = 1;
  string magicLink = 2;
  string expire = 3;
}

// Verify Magic Link Token
message VerifyMagicLinkRequest {
  string token = 1;
  string email = 2;

}

message VerifyMagicLinkResponse {
  AuthUser user = 1;
}

// Optional: Normal Registration (Username & Password)
message RegisterRequest {
  string username = 1;
  string email = 2;
  string password = 3;
}

message RegisterResponse {
  bool link_send = 1;
  string message = 2;
}

// Optional: Password Login (Fallback)
message LoginRequest {
  string email = 1;
  string password = 2;
}

message LoginResponse {
  AuthUser user = 1;
}

// =====================================
// OAuth Login (Google / GitHub)
// =====================================
message OAuthLoginRequest {
  string provider = 1; // google, github
  string token = 2;
}

message OAuthLoginResponse {
  AuthUser user = 1;
  string access_token = 2;
  string refresh_token = 3;
}

// =====================================
// Auth Service Definition
// =====================================
service AuthService {
  
  // Magic Link Authentication
  rpc SendMagicLink (SendMagicLinkRequest) returns (SendMagicLinkResponse);
  rpc VerifyMagicLink (VerifyMagicLinkRequest) returns (VerifyMagicLinkResponse);

  // Optional
  rpc Register (RegisterRequest) returns (RegisterResponse);
  rpc Login (LoginRequest) returns (LoginResponse);

  rpc OAuthLogin (OAuthLoginRequest) returns (OAuthLoginResponse);
}
